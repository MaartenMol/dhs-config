version: "3.4"

networks:
  net:
    driver: overlay
    attachable: true

volumes:
    nexus3: {}

services:
  nexus:
    image: sonatype/nexus3:3.21.1
    volumes:
      - nexus3:/nexus-data
    ports:
      - target: 8081
        published: 8081
        protocol: tcp
        mode: ingress
    networks:
      - net
    deploy:
      mode: replicated
      replicas: 1
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 10s
      placement:
        constraints:
          - node.role == manager
      resources:
        limits:
          memory: 4096M
        reservations:
          memory: 1024M